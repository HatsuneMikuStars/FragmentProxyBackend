## [2024-04-07 12:20] Расширение типов процессных переменных в TypeScript

### Обнаруженная проблема
При использовании переменных окружения (`process.env.*`) в проекте, TypeScript выдает ошибки, так как по умолчанию в типе `ProcessEnv` определены только стандартные переменные Node.js, такие как `NODE_ENV`, `PATH` и т.д. При доступе к пользовательским переменным окружения возникает ошибка типизации:

```
Property "DB_TYPE" does not exist on type "ProcessEnv". Did you mean: "TZ"
```

### Решение
Создан файл `src/database/types/env.d.ts` с определением расширенного интерфейса `ProcessEnv` в глобальном пространстве имен:

```typescript
declare global {
  namespace NodeJS {
    interface ProcessEnv {
      // Определения пользовательских переменных окружения
      DB_TYPE?: string;
      FRAGMENT_API_HASH?: string;
      TON_WALLET_MNEMONIC?: string;
      // ... и другие переменные
      
      // Стандартные переменные Node.js (добавленные)
      NODE_ENV?: 'development' | 'production' | 'test';
      PORT?: string;
    }
  }
}

export {};
```

### Преимущества решения
1. **Корректная типизация**: TypeScript больше не выдает ошибки при доступе к пользовательским переменным окружения.
2. **Улучшенная документация**: Все доступные переменные окружения теперь перечислены и документированы в одном месте.
3. **Автодополнение в IDE**: Разработчики получают автодополнение при работе с `process.env.*`.
4. **Предотвращение опечаток**: TypeScript выдаст ошибку при обращении к несуществующей переменной окружения.

### Технические детали
- Использовано объявление `declare global` для расширения глобального пространства имен.
- Добавлен пустой `export {}` для того, чтобы файл обрабатывался как модуль.
- Все переменные окружения объявлены как опциональные (`?:`), так как они могут отсутствовать.
- Переменные сгруппированы по функциональному назначению для удобства поддержки.
- `NODE_ENV` типизирован как union-тип строк ('development' | 'production' | 'test'), чтобы обеспечить строгую типизацию при проверках окружения.

### Альтернативные подходы
1. **Использовать промежуточные переменные**:
   ```typescript
   const dbType = process.env.DB_TYPE || '';
   if (dbType === 'sqlite') { ... }
   ```
   
   Недостаток: не решает проблему типизации системно и требует повторения кода.

2. **Использовать кастинг типов**:
   ```typescript
   if ((process.env as any).DB_TYPE === 'sqlite') { ... }
   ```
   
   Недостаток: использует `any`, что противоречит принципам строгой типизации.

### Обновление [2024-04-07]
Добавлены следующие стандартные переменные окружения Node.js в определение типов:
- `NODE_ENV`: Определяет режим работы приложения ('development', 'production', 'test').
- `PORT`: Определяет порт, на котором будет запущен сервер.

Эти переменные используются в нескольких ключевых файлах проекта:
- `src/config.ts`: `NODE_ENV` для определения режима разработки
- `src/database/config/database.config.ts`: `NODE_ENV` для включения логирования в режиме разработки
- `src/server.ts`: `PORT` для установки порта сервера

### Ссылки
- [TypeScript Declaration Merging](https://www.typescriptlang.org/docs/handbook/declaration-merging.html)
- [TypeScript Global Augmentation](https://www.typescriptlang.org/docs/handbook/declaration-merging.html#global-augmentation)
- [Node.js process.env](https://nodejs.org/api/process.html#processenv) 