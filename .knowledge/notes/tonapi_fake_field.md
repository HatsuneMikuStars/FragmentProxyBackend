# Исследование поля fake в TonAPI для обнаружения подозрительных транзакций

## [2025-04-01 19:50] Результаты исследования

### Основные находки:

1. **Механизм идентификации подозрительных Jetton-транзакций в TON**

В документации и исходном коде обнаружены указания на то, что в экосистеме TON существует механизм маркировки подозрительных (фейковых) Jetton-транзакций. Этот механизм реализован в нескольких уровнях:

- **На уровне API**: В TonAPI от Tonkeeper имеется поле `fake` для обозначения подозрительных транзакций и токенов.
- **В кошельках**: Tonkeeper помечает транзакции с подозрительными Jetton как "FAKE", что видно в интерфейсе пользователя.
- **На сервисах**: Wonton.Fun также использует маркировку "FAKE" для обозначения подозрительных транзакций.

2. **Верификация Jetton в стандарте TEP-74**

Стандарт Jetton (TEP-74) содержит важный механизм верификации подлинности токенов:
```python
jetton_master = (
    await provider.run_get_method(
        address=sender, method="get_wallet_data", stack=[]
    )
)[2].load_address()
jetton_wallet = (
    (
        await provider.run_get_method(
            address=jetton_master,
            method="get_wallet_address",
            stack=[
                begin_cell()
                .store_address(MY_WALLET_ADDRESS)
                .end_cell()
                .begin_parse()
            ],
        )
    )[0]
    .load_address()
    .to_str(1, 1, 1)
)

if jetton_wallet != sender:
    print("FAKE Jetton Transfer")
    continue
```

3. **Механизм маркировки в TonAPI**

На основе GitHub-issue tonkeeper/tonapi [#89](https://github.com/tonkeeper/tonapi/issues/89) обнаружено, что:

- Транзакции и токены могут быть помечены как "FAKE" в интерфейсе Tonkeeper и других сервисах, использующих TonAPI
- Эта пометка отображается в поле `symbol`, где вместо оригинального символа токена отображается "FAKE"
- Предположительно, в API есть специальное поле для обозначения подозрительных токенов

### Выводы:

1. **API поле**: В TonAPI от Tonkeeper используется поле, которое помечает подозрительные токены/транзакции как фейковые. Это поле используется клиентскими приложениями для отображения предупреждений пользователям.

2. **Алгоритм определения подозрительности**: Основывается на следующих проверках:
   - Несоответствие адреса кошелька токена с адресом, полученным от мастер-контракта
   - Подозрительные имена, символы или содержимое метаданных токена
   - Проверка на известные адреса мошенников

3. **Рекомендации по использованию**:
   - Для интеграции в приложение необходимо использовать TonAPI от Tonkeeper
   - API endpoint: предположительно `/v2/accounts/{account}/assets` с полями `is_fake` или `fake` в ответе
   - Полученное значение должно использоваться для предупреждения пользователей о потенциально подозрительных транзакциях

## [2025-04-01 20:05] План дальнейших действий

1. **Интеграция с TonAPI**:
   - Использовать официальное API от Tonkeeper для получения информации о токенах и транзакциях
   - Проверять поле `fake` или аналогичное в ответе API
   - Обрабатывать эти данные для предупреждения пользователей

2. **Дополнительная проверка**:
   - Имплементировать собственный метод проверки по известным паттернам 
   - Использовать проверку соответствия адреса кошелька токена адресу от мастер-контракта
   - Проверять токены на известные шаблоны мошенничества (TON в имени, системные сообщения и т.д.)

3. **UI/UX обработка**:
   - Разработать интерфейс для отображения предупреждений о подозрительных токенах/транзакциях
   - Давать пользователю возможность скрыть или удалить подозрительные токены

## [2025-04-01 20:15] Пример ожидаемого формата ответа API

```json
{
  "account": "EQAvCMPMXmHmUHKrGCLbsD5Z87dGCQJJ2oFf-3_x21qqGASA",
  "jettons": [
    {
      "address": "0:a43b42c4dafdce37118c0fbcae22bda8cdf4d8e326d4997e759a82c1060e3b08",
      "balance": "100000000000",
      "symbol": "BUTTON", 
      "name": "Press That Button",
      "decimals": 9,
      "image": "https://cache.tonapi.io/imgproxy/...",
      "verification": "whitelist",
      "is_scam": false
    },
    {
      "address": "0:eab293055d3ebc3fc1e35aa78bbf5fa7e8e5dd82d62ef12d0091797ae2392011",
      "balance": "1000000000",
      "symbol": "FAKE", // Оригинальный символ заменён на FAKE
      "name": "FAKE", // Оригинальное имя заменено на FAKE
      "decimals": 9,
      "image": null,
      "verification": "none",
      "is_scam": true, // Поле, указывающее на подозрительность
      "fake": true // Предполагаемое поле API
    }
  ]
}
``` 