# Проект FragmentProxyBackend - Обзор и последние изменения

## [2024-06-15 19:00] Краткий обзор проекта

### Назначение проекта

FragmentProxyBackend - это приложение для автоматизированной покупки Telegram Stars с использованием TON блокчейна и платформы Fragment. Основные возможности:

1. **Приём платежей через TON** - пользователи переводят TON на кошелёк системы с указанием своего Telegram-имени в комментарии
2. **Автоматическая конвертация TON в звёзды** - система автоматически конвертирует полученные TON в звёзды по текущему курсу
3. **Отправка звёзд получателю** - система отправляет купленные звёзды указанному в комментарии пользователю
4. **Мониторинг и отчётность** - система отслеживает все транзакции и предоставляет API для получения статистики

### Архитектура системы

```
Пользователь TON → TonWalletService → TonTransactionMonitor → FragmentStarsPurchaseService → Fragment API
                        ↓                         ↓                       ↓
                  TON Blockchain            База данных            Fragment Платформа
```

### Основные компоненты

1. **TonWalletService** - сервис для работы с TON кошельком, отвечает за получение транзакций и отправку TON
2. **FragmentStarsPurchaseService** - сервис для покупки звёзд через Fragment API
3. **TonTransactionMonitor** - сервис мониторинга входящих транзакций и их обработки
4. **TransactionRepository** - репозиторий для работы с базой данных транзакций
5. **API Server** - REST API сервер для получения статистики и управления системой

## [2024-06-15 19:15] Реализация фильтрации транзакций по типу

### Внесённые изменения

1. **Модель `GetTransactionsParams`**
   - Добавлен новый параметр `type?: TransactionType` для фильтрации транзакций по типу
   - Параметр является опциональным для сохранения обратной совместимости

2. **Метод `getTransactions` в TonWalletService**
   - Добавлена логика фильтрации по типу транзакции после получения данных из блокчейна
   - Фильтрация применяется, только если параметр типа указан

3. **Использование в TonTransactionMonitor**
   - Метод `checkNewTransactions` теперь запрашивает только входящие транзакции
   - Это оптимизирует обработку транзакций, так как монитор должен отслеживать только входящие платежи

### Преимущества нового подхода

1. **Производительность** - обрабатывается меньше транзакций, только релевантные для покупки звёзд
2. **Точность** - исключены ложные срабатывания на исходящие транзакции
3. **Обратная совместимость** - существующий код продолжает работать корректно

### ASCII-Диаграмма процесса фильтрации

```
              Параметры запроса
                     │
TON API ───► Получение транзакций ───► Конвертация в WalletTransaction
                     │
                     ▼
          Фильтрация по типу (если указан)
                     │
                     ▼
      Возврат отфильтрованных транзакций
``` 